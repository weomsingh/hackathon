<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>RingGuard - Money Muling Detection</title>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;700&family=DM+Mono:wght@400;500&family=Fraunces:opsz,wght@9..144,600&display=swap" rel="stylesheet" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.8.5/d3.min.js"></script>
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}" />
</head>
<body>
  <div class="layout">
    <header class="topbar">
      <div>
        <h1>RingGuard</h1>
        <p>Forensic Transaction Intelligence</p>
      </div>
      <a class="link-btn" href="{{ url_for('static', filename='sample_transactions.csv') }}">Use Sample CSV</a>
    </header>

    <section class="card upload-card">
      <h2>Upload Transactions</h2>
      <p class="muted">Upload CSV to detect circular flows, smurfing patterns, and shell chains.</p>
      <div id="dropZone" class="drop-zone">
        <div>Drop .csv file here or click to browse</div>
        <input id="fileInput" type="file" accept=".csv" hidden />
      </div>
      <div id="fileInfo" class="file-info"></div>
      <button id="analyzeBtn" class="btn btn-primary">Analyze for Fraud Rings ‚Üí</button>
      <div id="errorBox" class="error-box"></div>
    </section>

    <section id="emptyState" class="empty-state card">
      <div class="big-icon">üîç</div>
      <p class="empty-title">Upload a transaction CSV to begin analysis</p>
      <p class="muted">RingGuard will detect circular fund flows, smurfing patterns, and shell account chains</p>
    </section>

    <section id="resultsSection" class="results-section" style="display:none;">
      <div id="summaryGrid" class="summary-grid"></div>

      <div class="graph-and-side">
        <div class="card graph-card">
          <div class="card-head">
            <h3>Transaction Network Graph</h3>
            <div class="muted small">Hover node for tooltip, click node for detail panel</div>
          </div>
          <div id="graphContainer"></div>
          <div class="graph-controls">
            <button id="zoomInBtn" class="pill-btn">Zoom In</button>
            <button id="zoomOutBtn" class="pill-btn">Zoom Out</button>
            <button id="resetViewBtn" class="pill-btn">Reset View</button>
            <button id="highlightFraudBtn" class="pill-btn">Highlight Fraud Only</button>
            <button id="showAllConnectionsBtn" class="pill-btn">Show All Connections</button>
          </div>
        </div>

        <aside class="card side-card">
          <h3>Node Detail</h3>
          <p class="muted">Click a node to inspect account details.</p>
        </aside>
      </div>

      <div class="card table-card">
        <div class="card-head between">
          <h3>Detected Fraud Rings</h3>
          <button id="exportTableCsvBtn" class="pill-btn">Export Table as CSV</button>
        </div>
        <table>
          <thead>
            <tr>
              <th>Ring ID</th>
              <th>Pattern Type</th>
              <th>Members</th>
              <th>Risk Score</th>
              <th>Member Accounts</th>
            </tr>
          </thead>
          <tbody id="ringsTableBody"></tbody>
        </table>
      </div>

      <div class="card table-card">
        <div class="card-head">
          <h3>Flagged Accounts</h3>
          <p class="muted">(sorted by suspicion score, highest risk first)</p>
        </div>
        <div class="table-tools">
          <input id="accountSearch" type="text" placeholder="Filter by account ID, pattern, or ring ID" />
        </div>
        <table>
          <thead>
            <tr>
              <th>Rank</th>
              <th>Account ID</th>
              <th>Suspicion Score</th>
              <th>Ring</th>
              <th>Detected Patterns</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody id="suspiciousAccountsTable"></tbody>
        </table>
        <div class="pagination">
          <button id="prevPageBtn" class="pill-btn">Prev</button>
          <span id="pageInfo" class="muted"></span>
          <button id="nextPageBtn" class="pill-btn">Next</button>
        </div>
      </div>

      <div class="card export-card">
        <div class="export-actions">
          <button id="downloadJsonBtn" class="btn btn-primary">‚¨á Download JSON Report</button>
          <button id="copyJsonBtn" class="btn btn-outline-amber">üìã Copy JSON to Clipboard</button>
          <button id="exportCsvBtn" class="btn btn-outline-teal">üìä Export Accounts CSV</button>
        </div>
        <button id="togglePreviewBtn" class="pill-btn">Preview JSON Output ‚ñº</button>
        <pre id="jsonPreview" class="json-preview" style="display:none;"></pre>
      </div>
    </section>
  </div>

  <div id="nodeTooltip" class="node-tooltip" style="display:none;"></div>

  <aside id="nodeDetailPanel" class="node-detail-panel">
    <button id="closePanelBtn" class="panel-close">√ó</button>
    <div id="nodeDetailContent"></div>
  </aside>

  <script src="{{ url_for('static', filename='script.js') }}"></script>
</body>
</html>
